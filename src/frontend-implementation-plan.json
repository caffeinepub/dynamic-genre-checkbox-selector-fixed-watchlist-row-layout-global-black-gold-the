{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Add Manga dialog scroll-body (600px) + frontend backend-readiness stability improvements",
  "requirements": [
    {
      "id": "REQ-1",
      "summary": "Constrain Add Manga dialog to a fixed header/footer with a max-600px scrollable body area.",
      "acceptanceCriteria": [
        "When the Add Manga dialog is open, the header area stays visible at the top while scrolling the form fields.",
        "When the Add Manga dialog is open, the footer action buttons stay visible at the bottom while scrolling the form fields.",
        "The scrollable middle area has max-height: 600px (and uses vertical scrolling when content exceeds this height).",
        "Scrolling inside the dialog scrolls only the dialog body (not the page behind the modal).",
        "The layout remains usable on small viewports (mobile + small laptop) without introducing horizontal scrolling."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/manga/AddMangaDialog.tsx",
          "operation": "modify",
          "description": "Adjust the dialog layout to keep the header and footer as non-scrolling (shrink-0) regions, and make only the middle form area vertically scrollable with a max height of 600px. Ensure the dialog container prevents overflow leakage (no horizontal scroll) and that the scroll region uses available viewport height safely on small screens while still respecting the 600px max."
        },
        {
          "path": "frontend/src/components/manga/ADD_MANGA_DIALOG_LAYOUT_REGRESSION_CHECK.md",
          "operation": "modify",
          "description": "Update/append checklist items to explicitly verify: (1) body max-height 600px, (2) header/footer remain visible during body scroll, (3) no background/page scroll while interacting with the modal, (4) no horizontal scrolling on small viewports."
        }
      ]
    },
    {
      "id": "REQ-2",
      "summary": "Improve frontend backend connection stability via readiness gating, recovery retries, and clearer error state classification across actor/readiness hooks and manga list + add-manga flows.",
      "acceptanceCriteria": [
        "Backend readiness checks do not enter a failed state solely because the actor is temporarily null/uninitialized during startup; instead the UI remains in a connecting/waiting state until the actor exists.",
        "Retrying a backend connection from the UI triggers a full recovery attempt (including re-checking readiness and forcing a refresh/refetch of the actor query as needed), not just re-running the readiness check against a stale/missing actor.",
        "Error messaging distinguishes at minimum: (a) connecting/initializing, (b) transient network issues, and (c) authorization-required cases, and does not incorrectly label initialization states as permanent failures.",
        "Manga list loading, pagination changes, and add-manga submission remain gated on backend readiness and do not spam failing requests during reconnect scenarios.",
        "After a successful reconnect (readiness becomes ready), previously blocked operations (loading list, opening Add Manga, submitting Add Manga) work without requiring a full page reload."
      ],
      "file_operations": [
        {
          "path": "frontend/src/hooks/useBackendReadiness.ts",
          "operation": "modify",
          "description": "Harden readiness state machine so it does not transition to a failed state when the actor is null/uninitialized; keep status in connecting/waiting until an actor exists. Ensure the readiness query is only enabled when an actor is present, preserve original errors for accurate classification (connecting vs transient vs authorization), and avoid turning initialization states into permanent failures."
        },
        {
          "path": "frontend/src/hooks/useActorWithRetry.ts",
          "operation": "modify",
          "description": "Upgrade retry behavior to perform a full recovery attempt: trigger a refetch/refresh of the existing actor query via React Query (without editing immutable useActor.ts), then rerun readiness checks, and finally invalidate/refetch manga-related queries so the UI recovers automatically after readiness becomes ready. Prevent duplicate retries and keep connecting state accurate during recovery."
        },
        {
          "path": "frontend/src/components/manga/MangaListPage.tsx",
          "operation": "modify",
          "description": "Ensure list loading/pagination/opening Add Manga remain properly gated on readiness without spamming failing requests during reconnect. Refine displayed messaging to clearly differentiate connecting/initializing vs transient connection issues vs authorization-required states using the improved readiness categorization."
        },
        {
          "path": "frontend/src/components/manga/AddMangaDialog.tsx",
          "operation": "modify",
          "description": "Align add-manga submission and inline connection alerts with the improved readiness/retry behavior: avoid labeling actor initialization as a hard failure, keep the dialog in a waiting/connecting state until ready, and ensure the Retry action triggers the full recovery flow so users can submit successfully after reconnect without reloading."
        },
        {
          "path": "frontend/src/hooks/useMangaPage.ts",
          "operation": "modify",
          "description": "Tighten readiness gating and retry behavior to minimize repeated failing requests during reconnect scenarios, and ensure queries naturally resume after readiness becomes ready (without requiring a page reload)."
        },
        {
          "path": "frontend/src/hooks/useMangaMutations.ts",
          "operation": "modify",
          "description": "Ensure add/update/delete mutations remain strictly gated on readiness and actor existence, and that error messaging is consistent with the improved readiness classification (distinguishing initialization vs transient vs authorization) to support recovery after reconnect."
        },
        {
          "path": "frontend/src/utils/backendErrorClassification.ts",
          "operation": "modify",
          "description": "Expand/refine error classification patterns so initialization/actor-not-ready states are consistently categorized as connecting (retryable), transient network failures are reliably identified, and authorization-required errors remain non-retryable; ensure messages used by the UI do not mislabel connecting states as permanent failures."
        }
      ]
    }
  ]
}