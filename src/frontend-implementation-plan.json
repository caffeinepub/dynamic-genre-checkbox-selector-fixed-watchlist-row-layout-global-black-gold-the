{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Fix black screen on page refresh",
  "requirements": [
    {
      "id": "REQ-1",
      "summary": "Investigate and fix the black screen issue that occurs after page refresh, ensuring the manga list and all UI elements are visible without requiring mouse selection",
      "acceptanceCriteria": [
        "Page loads with visible content after refresh",
        "Background colors render correctly with the warm sepia/ink palette",
        "Text is visible without requiring mouse selection",
        "All manga cards and UI components display properly on initial load"
      ],
      "file_operations": [
        {
          "path": "frontend/src/index.css",
          "operation": "modify",
          "description": "Add CSS fallback colors for browsers that don't fully support OKLCH color space. Wrap OKLCH color definitions with @supports queries and provide RGB fallbacks. Ensure body, html, and root elements have explicit background colors set that override any potential browser defaults. Verify the warm sepia/ink palette (--color-bg-base, --color-bg-surface, --color-text-primary) is properly defined with both OKLCH and fallback values."
        },
        {
          "path": "frontend/tailwind.config.js",
          "operation": "modify",
          "description": "Review and ensure the OKLCH color system configuration includes proper fallback color values for browsers with limited OKLCH support. Verify that backgroundColor and textColor theme extensions properly reference the CSS custom properties defined in index.css. Ensure no null or undefined color values are present in the configuration."
        },
        {
          "path": "frontend/src/App.tsx",
          "operation": "modify",
          "description": "Add explicit background color class (bg-bg-base or equivalent) to the root container div to ensure the warm sepia background is applied immediately on mount, before any data loads. Verify no conditional rendering logic is preventing the base layout from displaying during the loading state. Ensure the layout structure renders with proper backgrounds even when backend connection is pending."
        },
        {
          "path": "frontend/src/components/layout/AppLayout.tsx",
          "operation": "modify",
          "description": "Add explicit background color classes to the main layout container and all major layout sections (header, main content area, footer) using the warm sepia palette. Ensure these background colors are applied via Tailwind classes that reference the OKLCH custom properties. Verify no CSS is inadvertently setting background to black or transparent."
        },
        {
          "path": "frontend/src/components/manga/MangaListPage.tsx",
          "operation": "modify",
          "description": "Ensure the page container has explicit background color classes applied using the warm sepia palette. Verify the loading state, empty state, and error state all render with proper background colors. Add text color classes to ensure text visibility during all states, including initial load and while data is being fetched."
        }
      ]
    },
    {
      "id": "REQ-2",
      "summary": "Verify that the OKLCH color system in index.css and tailwind.config.js is properly applied and not causing rendering issues with black backgrounds",
      "acceptanceCriteria": [
        "OKLCH colors are correctly parsed and applied by browsers",
        "Fallback colors are provided for browsers that don't support OKLCH",
        "Background colors use the intended warm sepia tones, not black"
      ],
      "file_operations": [
        {
          "path": "frontend/src/index.css",
          "operation": "modify",
          "description": "Implement comprehensive browser compatibility for OKLCH colors by adding @supports (color: oklch(0% 0 0)) queries with OKLCH definitions inside, and placing RGB/HSL fallback color definitions before the @supports block. Ensure fallbacks match the warm sepia/ink visual intent. Add comments documenting the color palette purpose and fallback strategy. Verify no CSS syntax errors exist that could cause the entire stylesheet to fail parsing."
        },
        {
          "path": "frontend/index.html",
          "operation": "modify",
          "description": "Add inline style to the root div element setting a fallback background color (warm sepia tone using standard CSS color format like rgb() or hex) to ensure something displays even if CSS fails to load or parse. This provides a last-resort visible background before any external styles are applied."
        }
      ]
    },
    {
      "id": "REQ-3",
      "summary": "Check service worker cache behavior to ensure it's not serving stale black screen content after refresh",
      "acceptanceCriteria": [
        "Service worker cache-first strategy does not cause black screen",
        "CSS and static assets are properly cached and served",
        "Cache invalidation works correctly when styles are updated"
      ],
      "file_operations": [
        {
          "path": "frontend/public/service-worker.js",
          "operation": "modify",
          "description": "Review the cache-first strategy implementation for CSS files and static assets. Add cache versioning using a cache name that includes a version identifier or timestamp. Implement proper cache cleanup in the activate event to remove outdated caches when the service worker updates. Ensure CSS files (index.css) are being cached and served correctly. Add logging to help diagnose cache-related issues. Consider adding a network-first or stale-while-revalidate strategy specifically for index.css to prevent serving stale styles after updates."
        },
        {
          "path": "frontend/src/sw/registerServiceWorker.ts",
          "operation": "modify",
          "description": "Add service worker update detection logic that prompts for page reload when a new service worker is waiting. Implement a mechanism to clear old caches when the app detects a version mismatch or on user-triggered cache clear. Ensure the clearServiceWorkerCache function properly handles cache deletion and confirms all relevant caches are removed. Add error handling for service worker registration failures that could leave the app in a broken state."
        },
        {
          "path": "frontend/src/components/layout/AppLayout.tsx",
          "operation": "modify",
          "description": "Add a development-mode cache diagnostic UI element or console logging that reports which resources were served from cache vs network. Consider adding a manual cache clear button visible in development or after detecting display issues. This helps verify that CSS and static assets are being served correctly after refresh."
        }
      ]
    }
  ]
}